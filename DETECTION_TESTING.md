# AT-02 Detection Testing Tools

‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö annotation detection algorithm ‡∏Å‡πà‡∏≠‡∏ô deploy ‡∏à‡∏£‡∏¥‡∏á

## üéØ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå

- ‡∏•‡∏î‡∏Å‡∏≤‡∏£ deploy ‡∏ö‡πà‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö parameters ‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß
- ‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏°‡∏µ annotation ‡∏Å‡∏µ‡πà‡πÄ‡∏™‡πâ‡∏ô ‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô
- ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á parameters ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡πà‡∏≠‡∏ô deploy

## üìÅ ‡πÑ‡∏ü‡∏•‡πå

### 1. `test-detection.js`
Script ‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö detection algorithm

**‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**
```bash
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
node test-detection.js

# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
node test-detection.js 60

# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö 24 ‡∏ä‡∏° + ‡∏õ‡∏£‡∏±‡∏ö threshold
node test-detection.js 1440 -0.01
```

**Parameters:**
- `minutes` - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏≤‡∏ó‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö (default: 1440 = 24 ‡∏ä‡∏°)
- `threshold` - slope threshold (default: -0.005)

### 2. `tune-detection.sh`
Interactive menu ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏ï‡πà‡∏≤‡∏á‡πÜ

**‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**
```bash
./tune-detection.sh
```

‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å scenario:
1. Very Sensitive - ‡∏à‡∏±‡∏ö‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á
2. Sensitive - ‡∏à‡∏±‡∏ö‡∏á‡πà‡∏≤‡∏¢ (‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô v20)
3. Moderate - ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á
4. Strict - ‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î
5. Custom - ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á

## üîß ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö:

1. **‡∏£‡∏±‡∏ô test script:**
   ```bash
   cd /home/teddy/deploy
   node test-detection.js 1440
   ```

2. **‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
   - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô detections ‡∏ó‡∏µ‡πà‡∏û‡∏ö
   - ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°-‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ detection
   - ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£‡∏ô‡πâ‡∏≥‡∏ó‡∏µ‡πà‡∏•‡∏î (m¬≥)
   - ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ô‡∏≤‡∏ó‡∏µ)

3. **‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏≠‡πÉ‡∏à‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
   - ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô `test-detection.js` (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 21-29)
   - ‡∏£‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏à‡∏ô‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£

4. **‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏≠‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß:**
   - ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤ parameters ‡πÑ‡∏õ‡πÉ‡∏™‡πà‡πÉ‡∏ô `frontend/src/main.js`
   - Deploy: `cd /home/teddy/deploy && docker-compose restart frontend`

## üìä Parameters ‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

### ‡πÉ‡∏ô test-detection.js (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 21-29):

```javascript
minConsecutivePoints: 2,      // ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏î‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô X ‡∏à‡∏∏‡∏î
minVolumeChange: 50,          // ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ X m¬≥
recoveryThreshold: 0.0005,    // slope >= X ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏´‡∏¢‡∏∏‡∏î‡∏•‡∏î
windowSize: 120,              // Moving average window (‡∏à‡∏∏‡∏î)
outlierThreshold: 0.15        // ‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á > X m = outlier
```

### ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤:

**‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡πâ‡∏ô‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô:**
- ‡∏•‡∏î `minConsecutivePoints` (‡πÄ‡∏ä‡πà‡∏ô 2 ‚Üí 1)
- ‡∏•‡∏î `minVolumeChange` (‡πÄ‡∏ä‡πà‡∏ô 50 ‚Üí 30)
- ‡∏•‡∏î `recoveryThreshold` (‡πÄ‡∏ä‡πà‡∏ô 0.0005 ‚Üí 0.0003)

**‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡πâ‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏•‡∏á (‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î‡∏Ç‡∏∂‡πâ‡∏ô):**
- ‡πÄ‡∏û‡∏¥‡πà‡∏° `minConsecutivePoints` (‡πÄ‡∏ä‡πà‡∏ô 2 ‚Üí 5)
- ‡πÄ‡∏û‡∏¥‡πà‡∏° `minVolumeChange` (‡πÄ‡∏ä‡πà‡∏ô 50 ‚Üí 200)
- ‡πÄ‡∏û‡∏¥‡πà‡∏° `recoveryThreshold` (‡πÄ‡∏ä‡πà‡∏ô 0.0005 ‚Üí 0.002)

## üéØ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

```
üìä DETECTION RESULTS
================================================================================
Total Detections: 2

üìç Detection #1:
   Start:    1/24/2026, 2:00:00 AM
   End:      1/24/2026, 5:30:00 AM
   Duration: 210.0 minutes
   Level:    3.245 m ‚Üí 3.089 m
   Drop:     0.156 m
   Volume:   546 m¬≥

üìç Detection #2:
   Start:    1/24/2026, 10:15:00 AM
   End:      1/24/2026, 1:45:00 PM
   Duration: 210.0 minutes
   Level:    3.187 m ‚Üí 3.034 m
   Drop:     0.153 m
   Volume:   536 m¬≥
```

## üí° Tips

1. **‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 24 ‡∏ä‡∏°** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
2. **‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡πÄ‡∏•‡∏¢** ‡πÉ‡∏´‡πâ‡∏•‡∏î `minVolumeChange` ‡πÅ‡∏•‡∏∞ `minConsecutivePoints`
3. **‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠‡πÄ‡∏¢‡∏≠‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ** ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á
4. **Moving Average 60 ‡∏ô‡∏≤‡∏ó‡∏µ** ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏£‡∏ö‡∏Å‡∏ß‡∏ô
5. **‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á** ‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡πà‡πÉ‡∏à

## üöÄ Workflow ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥

```bash
# 1. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
node test-detection.js

# 2. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏≠‡πÉ‡∏à ‡πÉ‡∏ä‡πâ interactive tuner
./tune-detection.sh

# 3. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏≠‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô main.js
nano frontend/src/main.js

# 4. Deploy
cd /home/teddy/deploy
docker-compose stop frontend
docker-compose rm -f frontend  
docker-compose up -d --build frontend
```

## üìù Version History

- v20: Current parameters
  - minConsecutivePoints: 2
  - minVolumeChange: 50 m¬≥
  - recoveryThreshold: 0.0005
  - windowSize: 120 (60 min)
  - Outlier removal: 0.15 m threshold
